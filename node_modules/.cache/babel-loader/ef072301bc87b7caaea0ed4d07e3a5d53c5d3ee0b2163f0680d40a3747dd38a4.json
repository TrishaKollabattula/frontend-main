{"ast":null,"code":"// src/components/FacebookConnect.js\nimport React,{useState}from'react';import{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";const FacebookConnect=_ref=>{let{appUser,onConnected,connected,status}=_ref;const[isConnecting,setIsConnecting]=useState(false);const handleConnect=()=>{setIsConnecting(true);// Same Facebook App ID as Instagram (your Meta app)\nconst clientId='1095157869184608';const redirectUri=encodeURIComponent('https://13.233.45.167:5000/social/facebook/callback');// Use pages_manage_posts instead of pages_manage_content\nconst scope=encodeURIComponent('pages_show_list,pages_read_engagement,pages_manage_posts');const state=encodeURIComponent(appUser||'random_state');const url=\"https://www.facebook.com/v20.0/dialog/oauth?client_id=\".concat(clientId,\"&redirect_uri=\").concat(redirectUri,\"&scope=\").concat(scope,\"&response_type=code&state=\").concat(state);console.log('[FACEBOOK] Opening OAuth popup...');console.log('[FACEBOOK] URL:',url);// Open popup for Facebook OAuth\nconst popup=window.open(url,'facebook_oauth','width=600,height=600,scrollbars=yes,resizable=yes');if(!popup){alert('Popup blocked! Please allow popups for this site.');setIsConnecting(false);return;}// Listen for the OAuth callback\nconst handleMessage=event=>{console.log('[FACEBOOK] Received message:',event.data);if(event.data.type==='facebook_callback'){setIsConnecting(false);if(popup&&!popup.closed){popup.close();}if(event.data.success){console.log('✅ Facebook connected:',event.data);alert(\"Facebook connected successfully!\\nPage: \".concat(event.data.page_name));onConnected();// Refresh status\n}else{console.error('❌ Facebook connection failed:',event.data.error);alert(\"Facebook connection failed: \".concat(event.data.error));}window.removeEventListener('message',handleMessage);}};window.addEventListener('message',handleMessage);// Handle popup close without callback\nconst checkClosed=setInterval(()=>{if(popup.closed){console.log('[FACEBOOK] Popup closed');setIsConnecting(false);window.removeEventListener('message',handleMessage);clearInterval(checkClosed);}},1000);};const handleDisconnect=async()=>{if(!window.confirm('Are you sure you want to disconnect Facebook?')){return;}try{const token=localStorage.getItem('token');const response=await fetch('http://13.233.45.167:5000/social/facebook/disconnect',{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)},body:JSON.stringify({app_user:appUser})});const result=await response.json();if(response.ok&&result.success){alert('Facebook disconnected successfully!');onConnected();// Refresh status\n}else{alert(\"Failed to disconnect Facebook: \".concat(result.error||'Unknown error'));}}catch(error){console.error('Error disconnecting Facebook:',error);alert('Error disconnecting Facebook. Please try again.');}};const getButtonText=()=>{if(isConnecting)return'Connecting...';if(connected&&status!==null&&status!==void 0&&status.page_name){return\"Disconnect \".concat(status.page_name);}return connected?'Disconnect Facebook':'Connect Facebook';};const getStatusText=()=>{if(!connected)return null;if(status!==null&&status!==void 0&&status.page_name){return/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'12px',color:'#666',marginTop:'4px'},children:[\"Page: \",status.page_name]});}return'Connected';};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{className:\"connect-button \".concat(connected?'connected':'disconnected'),onClick:connected?handleDisconnect:handleConnect,disabled:isConnecting,style:{backgroundColor:connected?'#dc3545':'#1877f2',color:'white',border:'none',padding:'10px 20px',borderRadius:'5px',cursor:isConnecting?'not-allowed':'pointer',opacity:isConnecting?0.6:1,fontSize:'14px',fontWeight:'500'},children:getButtonText()}),getStatusText()]});};export default FacebookConnect;","map":{"version":3,"names":["React","useState","jsxs","_jsxs","jsx","_jsx","FacebookConnect","_ref","appUser","onConnected","connected","status","isConnecting","setIsConnecting","handleConnect","clientId","redirectUri","encodeURIComponent","scope","state","url","concat","console","log","popup","window","open","alert","handleMessage","event","data","type","closed","close","success","page_name","error","removeEventListener","addEventListener","checkClosed","setInterval","clearInterval","handleDisconnect","confirm","token","localStorage","getItem","response","fetch","method","headers","body","JSON","stringify","app_user","result","json","ok","getButtonText","getStatusText","style","fontSize","color","marginTop","children","className","onClick","disabled","backgroundColor","border","padding","borderRadius","cursor","opacity","fontWeight"],"sources":["C:/Users/Vibek Rana/Pictures/frontend-main/src/components/FacebookConnect.js"],"sourcesContent":["// src/components/FacebookConnect.js\r\nimport React, { useState } from 'react';\r\n\r\nconst FacebookConnect = ({ appUser, onConnected, connected, status }) => {\r\n  const [isConnecting, setIsConnecting] = useState(false);\r\n\r\n  const handleConnect = () => {\r\n    setIsConnecting(true);\r\n    \r\n    // Same Facebook App ID as Instagram (your Meta app)\r\n    const clientId = '1095157869184608';\r\n    const redirectUri = encodeURIComponent('https://13.233.45.167:5000/social/facebook/callback');\r\n    // Use pages_manage_posts instead of pages_manage_content\r\n    const scope = encodeURIComponent('pages_show_list,pages_read_engagement,pages_manage_posts');\r\n    const state = encodeURIComponent(appUser || 'random_state');\r\n    \r\n    const url = `https://www.facebook.com/v20.0/dialog/oauth?client_id=${clientId}&redirect_uri=${redirectUri}&scope=${scope}&response_type=code&state=${state}`;\r\n    \r\n    console.log('[FACEBOOK] Opening OAuth popup...');\r\n    console.log('[FACEBOOK] URL:', url);\r\n    \r\n    // Open popup for Facebook OAuth\r\n    const popup = window.open(\r\n      url,\r\n      'facebook_oauth',\r\n      'width=600,height=600,scrollbars=yes,resizable=yes'\r\n    );\r\n\r\n    if (!popup) {\r\n      alert('Popup blocked! Please allow popups for this site.');\r\n      setIsConnecting(false);\r\n      return;\r\n    }\r\n\r\n    // Listen for the OAuth callback\r\n    const handleMessage = (event) => {\r\n      console.log('[FACEBOOK] Received message:', event.data);\r\n      \r\n      if (event.data.type === 'facebook_callback') {\r\n        setIsConnecting(false);\r\n        \r\n        if (popup && !popup.closed) {\r\n          popup.close();\r\n        }\r\n        \r\n        if (event.data.success) {\r\n          console.log('✅ Facebook connected:', event.data);\r\n          alert(`Facebook connected successfully!\\nPage: ${event.data.page_name}`);\r\n          onConnected(); // Refresh status\r\n        } else {\r\n          console.error('❌ Facebook connection failed:', event.data.error);\r\n          alert(`Facebook connection failed: ${event.data.error}`);\r\n        }\r\n        \r\n        window.removeEventListener('message', handleMessage);\r\n      }\r\n    };\r\n\r\n    window.addEventListener('message', handleMessage);\r\n\r\n    // Handle popup close without callback\r\n    const checkClosed = setInterval(() => {\r\n      if (popup.closed) {\r\n        console.log('[FACEBOOK] Popup closed');\r\n        setIsConnecting(false);\r\n        window.removeEventListener('message', handleMessage);\r\n        clearInterval(checkClosed);\r\n      }\r\n    }, 1000);\r\n  };\r\n\r\n  const handleDisconnect = async () => {\r\n    if (!window.confirm('Are you sure you want to disconnect Facebook?')) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      \r\n      const response = await fetch('http://13.233.45.167:5000/social/facebook/disconnect', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${token}`\r\n        },\r\n        body: JSON.stringify({\r\n          app_user: appUser\r\n        })\r\n      });\r\n\r\n      const result = await response.json();\r\n      \r\n      if (response.ok && result.success) {\r\n        alert('Facebook disconnected successfully!');\r\n        onConnected(); // Refresh status\r\n      } else {\r\n        alert(`Failed to disconnect Facebook: ${result.error || 'Unknown error'}`);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error disconnecting Facebook:', error);\r\n      alert('Error disconnecting Facebook. Please try again.');\r\n    }\r\n  };\r\n\r\n  const getButtonText = () => {\r\n    if (isConnecting) return 'Connecting...';\r\n    if (connected && status?.page_name) {\r\n      return `Disconnect ${status.page_name}`;\r\n    }\r\n    return connected ? 'Disconnect Facebook' : 'Connect Facebook';\r\n  };\r\n\r\n  const getStatusText = () => {\r\n    if (!connected) return null;\r\n    \r\n    if (status?.page_name) {\r\n      return (\r\n        <div style={{ fontSize: '12px', color: '#666', marginTop: '4px' }}>\r\n          Page: {status.page_name}\r\n        </div>\r\n      );\r\n    }\r\n    \r\n    return 'Connected';\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <button \r\n        className={`connect-button ${connected ? 'connected' : 'disconnected'}`}\r\n        onClick={connected ? handleDisconnect : handleConnect}\r\n        disabled={isConnecting}\r\n        style={{\r\n          backgroundColor: connected ? '#dc3545' : '#1877f2',\r\n          color: 'white',\r\n          border: 'none',\r\n          padding: '10px 20px',\r\n          borderRadius: '5px',\r\n          cursor: isConnecting ? 'not-allowed' : 'pointer',\r\n          opacity: isConnecting ? 0.6 : 1,\r\n          fontSize: '14px',\r\n          fontWeight: '500'\r\n        }}\r\n      >\r\n        {getButtonText()}\r\n      </button>\r\n      {getStatusText()}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default FacebookConnect;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}